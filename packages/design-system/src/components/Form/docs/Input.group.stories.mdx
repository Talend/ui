import { Canvas, Meta, Story } from '@storybook/addon-docs';
import { useForm } from 'react-hook-form';
import { FigmaImage } from '~docs';
import { InlineMessageInformation } from '../../InlineMessage';
import { ButtonPrimary } from '../../Button';
import { action } from '@storybook/addon-actions';
import Form from '../';

<Meta
	title="Components/Form/Form Field Group"
	parameters={{
		status: { figma: 'ok', storybook: 'ok', react: 'ok', i18n: 'na' },
	}}
/>

# Field groups

A field group extends the form controls by adding simple text, select or buttons on either side of the default field.

All the current inputs are potential field groups. Fill in their `prefix` or `suffix` prop and the deed is done.

## Zoning

<FigmaImage
	src="https://www.figma.com/file/qc8oUSyVJM67gSsbTShftt/%F0%9F%93%90-Zoning?node-id=249%3A129"
	alt="zoning image for field groups"
/>

## Style

### Variations

#### Affixes

<FigmaImage
	src="https://www.figma.com/file/FaYIWpJeP6LwjWr78L8eAr/Forms?node-id=2008%3A1"
	alt="An input group demo"
/>

Affixes are either `prefix` or `suffix`. Use one of the following object types to fill them in.

Both `prefix` and `affix` accept the same objects.

<Canvas>
	<Story name="select">
		<Form.Url
			name="URL"
			label="Input"
			placeholder="www.talend.com"
			suffix={{
				type: 'text',
				children: '.com',
			}}
			prefix={{
				type: 'select',
				label: 'Protocol',
				name: 'protocol',
				required: true,
				defaultValue: 'https://',
				children: (
					<>
						<option>http://</option>
						<option>https://</option>
						<option>ftp://</option>
						<option>pop3://</option>
						<option>imap://</option>
						<option>smtp://</option>
					</>
				),
			}}
		/>
	</Story>
</Canvas>

<Canvas>
	<Story name="button">
		<Form.Url
			name="URL"
			label="Input"
			placeholder="www.talend.com"
			suffix={{
				type: 'text',
				children: '.com',
			}}
			prefix={{
				type: 'button',
				icon: 'upload',
				onClick: () => action('Clicked'),
				children: 'A button',
			}}
		/>
	</Story>
</Canvas>

<Canvas>
	<Story name="button icon">
		<Form.Url
			name="URL"
			label="Input"
			placeholder="www.talend.com"
			suffix={{
				type: 'text',
				children: '.com',
			}}
			prefix={{
				type: 'button',
				icon: 'upload',
				onClick: () => action('Clicked'),
				children: 'A button',
				hideText: true,
			}}
		/>
	</Story>
</Canvas>

#### Select

<FigmaImage
	src="https://www.figma.com/file/FaYIWpJeP6LwjWr78L8eAr/Forms?node-id=2008%3A1010"
	alt="An input group demo"
/>

Affixes are not limited to text inputs. `Form.Select`, `Form.Datalist` also work with the same ruleset.

<Canvas>
	<Story name="select--select">
		<Form.Select
			name="column"
			label="Input"
			prefix={{
				type: 'select',
				label: 'type',
				name: 'type',
				defaultValue: 'Column',
				children: (
					<>
						<option>Value</option>
						<option>Column</option>
					</>
				),
			}}
		>
			<option>Id</option>
			<option>Name</option>
			<option selected>Country</option>
			<option>Age</option>
		</Form.Select>
	</Story>
</Canvas>

Even multiple selects can be grouped with affixes.

<Canvas>
	<Story name="select--multiple-select">
		<Form.Select
			name="column"
			label="Input"
			multiple
			prefix={{
				type: 'select',
				label: 'type',
				name: 'type',
				defaultValue: 'Column',
				children: (
					<>
						<option>Value</option>
						<option>Column</option>
					</>
				),
			}}
		>
			<option>Id</option>
			<option>Name</option>
			<option selected>Country</option>
			<option>Age</option>
		</Form.Select>
	</Story>
</Canvas>

## States

### Default

<FigmaImage
	src="https://www.figma.com/file/FaYIWpJeP6LwjWr78L8eAr/Forms?node-id=2008%3A406"
	alt="An input group demo"
/>

<Canvas>
	<Story name="default">
		<Form.Number name="input" label="Input" prefix="$" suffix=".00" />
	</Story>
</Canvas>

### Filled

<FigmaImage
	src="https://www.figma.com/file/FaYIWpJeP6LwjWr78L8eAr/Forms?node-id=2008%3A553"
	alt="An input group demo"
/>

<Canvas>
	<Story name="filled">
		<Form.Number defaultValue="100" label="Input" prefix="$" suffix=".00" name="input" />
	</Story>
</Canvas>

### Disabled

<FigmaImage
	src="https://www.figma.com/file/FaYIWpJeP6LwjWr78L8eAr/Forms?node-id=2008%3A605"
	alt="An input group demo"
/>

<Canvas>
	<Story name="disabled">
		<Form.Number defaultValue="100" label="Input" prefix="$" suffix=".00" name="input" disabled />
	</Story>
</Canvas>

### Read only

<FigmaImage
	src="https://www.figma.com/file/FaYIWpJeP6LwjWr78L8eAr/Forms?node-id=2008%3A657"
	alt="An input group demo"
/>

<Canvas>
	<Story name="read-only">
		<Form.Number defaultValue="100" label="Input" prefix="$" suffix=".00" name="input" readOnly />
	</Story>
</Canvas>

## Content

Use lower case on prefix and suffix except if it's an interactive element.

## Interactions

- The visible label will be linked to the principal field, click on it to access to the field (:focus)

## Usage

### Use with RHF

Here's an example using a `select` type affix with React Hooks Form

<Canvas>
	<Story name="react-hook-form">
		{() => {
			const { register, handleSubmit, watch } = useForm();
			const [formData, setFormData] = React.useState();
			return (
				<Form onSubmit={handleSubmit(setFormData)}>
					{formData && (
						<InlineMessageInformation
							title={'Form data'}
							description={JSON.stringify(formData, null, 2)}
							withBackground
						/>
					)}
					<Form.Text
						label="API Key"
						prefix={{
							...register('prefix'),
							type: 'select',
							label: 'Type',
							children: [
								<option value="Public">Public</option>,
								<option value="Private">Private</option>,
							],
							defaultValue: 'Public',
						}}
						suffix={{
							type: 'button',
							onClick: () => {},
							icon: 'talend-files-o',
							hideText: true,
							children: 'Do something',
						}}
						description="The input seems readonly and the value is not displayed while submitting the form"
						defaultValue={42}
						{...register('apiKey')}
					/>
					<Form.Buttons>
						<ButtonPrimary type="submit" onClick={() => {}}>
							Submit
						</ButtonPrimary>
					</Form.Buttons>
				</Form>
			);
		}}
	</Story>
</Canvas>

## Accessibility

- The visible label describes the whole group.
- The invisible labels describe the direct input they are linked to.
