<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: reducers/settingsReducers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: reducers/settingsReducers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module react-cmf/lib/reducers/settingsReducers
 */
/* eslint no-underscore-dangle: ["error", {"allow": ["_ref"] }]*/

import get from 'lodash/get';
import invariant from 'invariant';
import CONSTANTS from '../constant';

export const defaultState = {
	initialized: false,
	contentTypes: {},
	actions: {},
	props: {},
	routes: {},
};

/**
 * if an object try to find _ref property and resolve it
 */
export function attachRef(refs, obj) {
	if (obj === null || typeof obj !== 'object' || Array.isArray(obj)) {
		return obj;
	}
	let props = Object.assign({}, obj);
	if (props._ref) {
		invariant(refs[props._ref], `CMF/Settings: Reference '${props._ref}' not found`);
		props = Object.assign({}, refs[props._ref], obj);
		delete props._ref;
	}
	return props;
}

export function attachRefs(refs, props) {
	const attachedProps = attachRef(refs, props);
	Object.keys(attachedProps).forEach(key => {
		attachedProps[key] = attachRef(refs, attachedProps[key]);
	});
	return attachedProps;
}

/**
 * attach reference to produce a ready to use freezed object
 * @param {object} originalSettings the full settings with `props` and `ref` attribute
 * @return {object} frozen settings with ref computed
 */
function prepareSettings({ views, props, ref, ...rest }) {
	const settings = Object.assign({ props: {} }, { ...rest });
	if (views) {
		if (process.env.NODE_ENV === 'development') {
			// eslint-disable-next-line no-console
			console.warn('settings.view is deprecated, please use settings.props');
		}
		Object.keys(views).forEach(id => {
			settings.props[id] = attachRefs(ref, views[id]);
		});
	}
	if (props) {
		Object.keys(props).forEach(id => {
			settings.props[id] = attachRefs(ref, props[id]);
		});
	}
	if (typeof settings.freeze === 'function') {
		settings.freeze();
	}
	return settings;
}

/**
 * handle actions related to the settings
 * @param  {object} state  initial state
 * @param  {object} action redux aciton
 * @return {object}        new state
 */
export function settingsReducers(state = defaultState, action) {
	switch (action.type) {
		case CONSTANTS.REQUEST_OK:
			return Object.assign({}, state, { initialized: true }, prepareSettings(action.settings));
		case CONSTANTS.REQUEST_KO:
			// eslint-disable-next-line no-console
			console.error(`Settings can't be loaded ${get(action, 'error.message')}`, action.error);
			return state;
		default:
			return state;
	}
}

export default settingsReducers;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-react-cmf.html">react-cmf</a></li><li><a href="module-react-cmf_lib_action.html">react-cmf/lib/action</a></li><li><a href="module-react-cmf_lib_actions.html">react-cmf/lib/actions</a></li><li><a href="module-react-cmf_lib_actions_collectionsActions.html">react-cmf/lib/actions/collectionsActions</a></li><li><a href="module-react-cmf_lib_actions_componentsActions.html">react-cmf/lib/actions/componentsActions</a></li><li><a href="module-react-cmf_lib_actions_settingsActions.html">react-cmf/lib/actions/settingsActions</a></li><li><a href="module-react-cmf_lib_App.html">react-cmf/lib/App</a></li><li><a href="module-react-cmf_lib_cmfConnect.html">react-cmf/lib/cmfConnect</a></li><li><a href="module-react-cmf_lib_componentState.html">react-cmf/lib/componentState</a></li><li><a href="module-react-cmf_lib_deprecated.html">react-cmf/lib/deprecated</a></li><li><a href="module-react-cmf_lib_Dispatcher.html">react-cmf/lib/Dispatcher</a></li><li><a href="module-react-cmf_lib_expression.html">react-cmf/lib/expression</a></li><li><a href="module-react-cmf_lib_Inject.html">react-cmf/lib/Inject</a></li><li><a href="module-react-cmf_lib_reducers.html">react-cmf/lib/reducers</a></li><li><a href="module-react-cmf_lib_reducers_collectionsReducers.html">react-cmf/lib/reducers/collectionsReducers</a></li><li><a href="module-react-cmf_lib_reducers_componentsReducers.html">react-cmf/lib/reducers/componentsReducers</a></li><li><a href="module-react-cmf_lib_reducers_settingsReducers.html">react-cmf/lib/reducers/settingsReducers</a></li><li><a href="module-react-cmf_lib_registry.html">react-cmf/lib/registry</a></li><li><a href="module-react-cmf_lib_RegistryProvider.html">react-cmf/lib/RegistryProvider</a></li><li><a href="module-react-cmf_lib_store.html">react-cmf/lib/store</a></li></ul><h3>Classes</h3><ul><li><a href="module-react-cmf_lib_Dispatcher.Dispatcher.html">Dispatcher</a></li><li><a href="module-react-cmf_lib_RegistryProvider.html">react-cmf/lib/RegistryProvider</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Mar 11 2019 11:45:34 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
