Report on the form lib status
===

Subject: list, find, estimate the missing features, bugs and architecture issues on the form lib react-jsonschema-form.

https://jira.talendforge.org/browse/TFD-1039


Context: the forms are generated by TCOMP + Daikon.
The jsonschema define the data structure, so we can have only one jsonschema per entity and the UI schema define the forms so we can have multiple uischema per entity.

docs & sources:
- https://mozilla-services.github.io/react-jsonschema-form/
- https://docs.angularjs.org/guide/forms
- http://schemaform.io/
- https://facebook.github.io/react/docs/forms.html
- http://redux-form.com/

Summary

- fieldset
- validation
- Error display (feedback on validation)
- Documentation
- Wizard
- Widgets
- Event handler
- Mutliple Submit
- Form state (valid, invalid, pristine, dirty, touched, untouched, pending)
- Conclusion

our architecture
===

Our architecture is the following.
JSONSchema + UISchema define a form which is send to the client which is in charge of displaying the form.
FormData can be added to the mix as to set default value for the model.
If the UIschema define triggers on some fields, change on said field can trigger a call back. Main usage of this feature was to allow TCOMP + Daikon to specify that certains part of the model change should trigger a refresh of the form definition (JSONSChema, UISchema). This by sending formData to the server so he can compute which part of the JSONSchema + UISchema to update and send back to the user.

fieldsets
===

definition: this is a group of field inside a form.
mainly used to outline different group of information to the user.
This element is important to properly display a complex form in any fashion the ux designer desire.
Fieldset can also hold a legen element giving this section a title.
Note that fieldset and fieldset nesting doesn't inpact the shape of the data submited by a form.
```
<form>
	<fieldset>
		<legend>Main Section</legend>
		<input type="text" name="foo" />
		<input type="text" name="bar" />
	</fieldset>
	<fieldset>
		<input type="text" name="ssl" />
	</fieldset>
</form>
```

Needs: We need to be able to build UI schema that define fieldset.
And we need to be able to specify which field goes in which fieldset if any is preset.
The payload must be as in HTML as if fieldset were not in the form.
```
// ?
{
	foo: '...',
	bar: '...',
	ssl: '...',
}
```

Fieldset may also be used as a widget for a field of type 'object';

Status:
In the current lib we need to change the jsonschema using an type='object' to group the fields. So we can't do as in HTML.

This change the shape of the serialized data sent to the server this is not what we want, because it require the backend server to handle a new step of data transcodification involving the JSONSchema and UISchema.

As a rule of thumb we don't want that the UISchema or the appeareance of the form to inpact the shape of the data.

What happens with schemaform lib:
- https://github.com/json-schema-form/json-schema-form/wiki/Documentation#fieldset-and-section
- http://schemaform.io/examples/bootstrap-example.html and select Kitchen Sink

> fieldset and section doesn't need a key. You can create generic groups with them. They do need a list of items to have as children.

So this is the way to go.

validation
===

Status:
The current lib proceed validation using jsonschema one entry point:

'validate' function(formData, errors) // errors['myfield'] || errors.addError('message')

by default validation happens on submit.
We can set liveValidate props at true to validate on every changes.

missing features:
- validate onBlur
- validate async (blocker)

redux-form lib support this in a far better way: http://redux-form.com/6.6.2/examples/asyncValidation/


Question: what is the validation mecanism server side ? May a component developer can create custom validation inside the component definition ?

Form validation command should be available outside the form component, example on action trigger, a callback function should be made available to trigger form validation and check validation status.

Answer:
- https://github.com/Talend/components/blob/master/services/components-api-service-rest/src/main/java/org/talend/components/service/rest/PropertiesController.java#L75
- https://github.com/Talend/daikon/blob/master/daikon/src/main/java/org/talend/daikon/properties/ValidationResult.java


Error display
===

Status: When the form status change to error, a global class is set on the form: 'has-error'.
When the errors comes from only one field, the field has also a class.
Messages are displayed next to the widget

errors are thrown validation in as a List you can customize using
*transformErrors* function(errors) to customize messages.

Customization: We can customize the ErrorList (global) but not per field
So If we want custom rendering for one field of the errors we can't;

Bug: Error displayed is remove when state.status === 'editing' so on each change.
This make the form flicking a lot
https://talendrd.slack.com/archives/C2N95B1KN/p1492092210208304

Documentation
===

The documentation of react-jsonschema-form is composed of a demo page, and big file full of examples. But lack of a complete API definition.
For example you can't find any documentation about UISchema that explain the possibilities. No references.

The documentation is considered as poor by all frontend guys. (need to read the source first)

Wizard
===

A wizard is a series of Forms with at the end a final submit with all the needed information.

~~react-jsonschema-form only allow wizard composed of one field per slide of the wizard.
Meaning that for complex wizard you have to build multiple forms
And coordonate them from outside making this complicated.~~

This is possible with one uiSchema per step. The uiSchema can compose multiple fields.

Example : https://jsfiddle.net/sn4bnw9h/1/ where you can add some fields in the steps uiSchema.

TComp can provide wizards (how ?)
TODO: see what is wizard from TCOMP and if it can be covered.

Widgets
===

All form libs provide the needed widgets + ability to create custom widget.
The only limitation we have with reac-jsonschema-form is the widget doesn't have the all formData. That has been fixed recently in our fork.

So no problem on widgets and customization here.

Event handler
===

We should not in our context need to do event handling except for custom form because of the trigger.
The only event handler we have used at the moment is the onChange to extract the form data into redux so we can play with the form data outside of the form.


Mutliple Submit
====

We can't have multiple submit button on form (because of event handling).
By default HTML let you do that and you can use the triggered event to know the button name so the action to trigger.

This has been implemented using custom actions using the onClick event but without the ability to call the validation process. This is a blocker for many feature.


Form state
===

valid, invalid, pristine, dirty, touched, untouched, pending

*Only invalid* exists with react-jsonschema-form.
So no way to customize widgets depending on the state or errors.

An example is I can't warn the user if the form is dirty and he is about to loose the form that his data are not saved.


Conclusion
====

(partials until all the things are reviewed)

We already have forked the library.
Because of the recursive approch on the jsonschema to render the form we will not being able to support fieldset / columns / tabs without a big refactoring of the core library and the UI schema structure.

The react-jsonschema-form lib has a good idea but a bad implementation with many design issues;

We are still at early usage and have so many problems that show us we may need to think a bit more about it.

* fieldsets are not supported and can't be fixed without a big refactoring
* multiple submits is not supported (we can find a workaround)
* advanced form state are not supported and need lots of work
* wizard are not supported at the moment
* error display flicks a lot (may be fixed)
* forms update flicks (because of our architecture)
* async validation is not supported and need lots of work
* validation error has not been integrated at the moment

Solutions
===

Need to talk
