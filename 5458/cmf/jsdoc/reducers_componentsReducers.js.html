<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: reducers/componentsReducers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: reducers/componentsReducers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint no-console: ["error", { allow: ["warn"] }] */
/**
 * @module react-cmf/lib/reducers/componentsReducers
 */
import get from 'lodash/get';
import { Map, fromJS } from 'immutable';
import invariant from 'invariant';
import CONSTANTS from '../constant';

export const defaultState = new Map();

/**
 * given the state and action, determine if another component try to bind to a specific
 * component name space state and warn the user about this behaviour
 * @param {Object} state the CMF application state
 * @param {Object} action a redux action
 */
export function warnIfAnotherComponentBind(state, action) {
	if (process.env.NODE_ENV !== 'production') {
		if (state.getIn([action.componentName, action.key])) {
			console.warn(`Beware component ${action.componentName} try to recreate an existing
 State namespace ${action.key}, meaning that the original one will be overloaded`);
		}
	}
}

/**
 * given the state and action, determine if a component at unmount try to delete
 * a state namespace that doesn't exist anymore and warn the user about this behavior
 * @param {Object} state the CMF application state
 * @param {Object} action a redux action
 */
export function warnIfRemovingStateDoesntExist(state, action) {
	if (process.env.NODE_ENV !== 'production') {
		if (!state.getIn([action.componentName, action.key])) {
			console.warn(`Beware the component ${action.componentName} try to remove a non existing
 State namespace ${action.key}, it isn't a normal behavior execpt if two component are binded
 to this specific namespace`);
		}
	}
}

/**
 * given the state and action, determine if a component try to update a state namespace that
 * doesn't exist, throw an errror at dev time since such a behavior may lead to unintended bug
 * or runtime errors later on app execution.
 * @param {Object} state the CMF application state
 * @param {Object} action a redux action
 */
export function errorIfMergingStateDoesntExist(state, action) {
	if (!state.getIn([action.componentName, action.key])) {
		invariant(
			process.env.NODE_ENV === 'production',
			`Error, the component ${action.componentName} try to mutate a non existing
 State namespace ${action.key}, this namespace may be not yet created or already removed.`,
		);
	}
}

/**
 * Reducer on charge to manage component remote state.
 * @param  {object} state  initial state
 * @param  {object} action the executed action
 * @return {object}        the new state
 */
export function componentsReducers(state = defaultState, action) {
	switch (action.type) {
		case CONSTANTS.COMPONENT_ADD_STATE:
			warnIfAnotherComponentBind(state, action);
			if (action.initialComponentState) {
				return state.setIn(
					[action.componentName, action.key],
					fromJS(action.initialComponentState),
				);
			}
			return state.setIn([action.componentName, action.key], new Map());
		case CONSTANTS.COMPONENT_MERGE_STATE:
			errorIfMergingStateDoesntExist(state, action);

			return state.mergeIn([action.componentName, action.key], fromJS(action.componentState));
		case CONSTANTS.COMPONENT_REMOVE_STATE:
			warnIfRemovingStateDoesntExist(state, action);
			return state.deleteIn([action.componentName, action.key]);
		default: {
			const subAction = get(action, 'cmf.componentState');
			if (subAction) {
				return componentsReducers(state, subAction);
			}
			return state;
		}
	}
}

export default componentsReducers;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-react-cmf.html">react-cmf</a></li><li><a href="module-react-cmf_lib_App.html">react-cmf/lib/App</a></li><li><a href="module-react-cmf_lib_Dispatcher.html">react-cmf/lib/Dispatcher</a></li><li><a href="module-react-cmf_lib_Inject.html">react-cmf/lib/Inject</a></li><li><a href="module-react-cmf_lib_RegistryProvider.html">react-cmf/lib/RegistryProvider</a></li><li><a href="module-react-cmf_lib_action.html">react-cmf/lib/action</a></li><li><a href="module-react-cmf_lib_actions.html">react-cmf/lib/actions</a></li><li><a href="module-react-cmf_lib_actions_collectionsActions.html">react-cmf/lib/actions/collectionsActions</a></li><li><a href="module-react-cmf_lib_actions_componentsActions.html">react-cmf/lib/actions/componentsActions</a></li><li><a href="module-react-cmf_lib_actions_settingsActions.html">react-cmf/lib/actions/settingsActions</a></li><li><a href="module-react-cmf_lib_cmfConnect.html">react-cmf/lib/cmfConnect</a></li><li><a href="module-react-cmf_lib_componentState.html">react-cmf/lib/componentState</a></li><li><a href="module-react-cmf_lib_deprecated.html">react-cmf/lib/deprecated</a></li><li><a href="module-react-cmf_lib_expression.html">react-cmf/lib/expression</a></li><li><a href="module-react-cmf_lib_reducers.html">react-cmf/lib/reducers</a></li><li><a href="module-react-cmf_lib_reducers_collectionsReducers.html">react-cmf/lib/reducers/collectionsReducers</a></li><li><a href="module-react-cmf_lib_reducers_componentsReducers.html">react-cmf/lib/reducers/componentsReducers</a></li><li><a href="module-react-cmf_lib_reducers_settingsReducers.html">react-cmf/lib/reducers/settingsReducers</a></li><li><a href="module-react-cmf_lib_registry.html">react-cmf/lib/registry</a></li><li><a href="module-react-cmf_lib_store.html">react-cmf/lib/store</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Dec 09 2024 08:12:05 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
