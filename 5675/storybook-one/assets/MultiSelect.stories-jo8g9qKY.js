import{j as s,P as o,r as d,c as u,I as T}from"./iframe-DIB3-0BR.js";import{m as D}from"./memoize-one.esm-BdPwpGay.js";import"./Action.component-DH-GAoec.js";import"./Actions.component-CD5rCVBo.js";import{A as N}from"./ActionButton.component-DQTMc3aF.js";import"./ActionIconToggle.component-CsrdTqc8.js";import"./ActionSplitDropdown.component-qEyNazAr.js";import{I}from"./constants-CZYEPhht.js";import"./index-DOjBLebZ.js";import{V as b,g as L}from"./index-DukvPaSF.js";import"./index-pFY2HaYN.js";import{C as M}from"./CircularProgress.component-CgPW_-zP.js";import{E as A}from"./Emphasis.component-CPMkp7uY.js";import"./index-SwZTiGtl.js";import{B as F}from"./Badge.component-B2VFJEX1.js";import{w as V}from"./withTranslation-C93BmHMx.js";import"./preload-helper-PPVm8Dsz.js";import"./TooltipTrigger.component-CVMfTS1k.js";import"./OverlayTrigger.component-DK-wOvtE.js";import"./RootCloseWrapper-BoYIv9I_.js";import"./interopRequireDefault-CBIuXflU.js";import"./Popover-ClBq45ZB.js";import"./Transition-DIDeI3r7.js";import"./Transition-Dw8bnBfP.js";import"./get-YPPIQngb.js";import"./_baseGet-Ct5VDv7d.js";import"./toString-B57_GXo2.js";import"./isSymbol-B6o2xB3b.js";import"./eq-w3r5tFL9.js";import"./omit-7Cusbh4T.js";import"./_setToString-DajbfPCu.js";import"./_getTag-UecFYJaC.js";import"./isArrayLike-OVmvncqg.js";import"./translate-Cb2TG_Ch.js";import"./DropdownButton-C6bBdUBg.js";import"./SplitButton-BMIBksG4.js";import"./inheritsLoose-DL4FPuFe.js";import"./Skeleton.component-ByoA-jbm.js";import"./theme-DaJrfx0F.js";import"./index-C-7ozozo.js";import"./_basePickBy-RcwYYN9k.js";import"./index-V6NEFxlN.js";import"./_baseIteratee-DAeMZ2mf.js";import"./_baseFindIndex-BCByNkxY.js";import"./_mapToArray-Dr1Ktip_.js";import"./_hasPath-pwvYVBH3.js";import"./CellMeasurerCache-BVT8JdN_.js";import"./CollapsiblePanel.component-Dv7W5yh6.js";import"./Status.component-CON5dMCx.js";import"./Panel-pYGku8eu.js";import"./locale-CYWHUjaY.js";import"./cjs-Bn1o0K2b.js";import"./cjs-CaCTkBcf.js";import"./locale-8EYSmhBF.js";import"./Checkbox-CsIgn8Ix.js";import"./flow-CzVvYXJ1.js";import"./noop-BdyXNs-O.js";import"./toInteger-DK8LkD2R.js";import"./toFinite-DPlhGQqT.js";import"./toNumber-AxTot3uP.js";import"./findIndex-D0SYQO8W.js";import"./cloneDeep-CtpIsLiE.js";import"./QualityBar.component-BKTOmN2b.js";const x="select-all",C="create-new",P="_dropdown_jf2gs_2",B="_loading_jf2gs_12",y={dropdown:P,loading:B};function _(n){return s.jsx("div",{className:y.dropdown,style:{height:n.height},children:n.isLoading?s.jsx("div",{className:y.loading,children:s.jsx(M,{})}):s.jsx(b,{type:"tc-multiselect-dropdown",rowHeight:n.renderItem.rowHeight,rowRenderers:{"tc-multiselect-dropdown":n.renderItem},collection:n.items,onRowClick:n.onRowClick})})}_.propTypes={isLoading:o.bool,height:o.number,renderItem:o.func,items:o.array,onRowClick:o.func};const H="_row_8hohg_2",U="_item_8hohg_34",S={row:H,item:U};class j extends d.Component{static getDerivedStateFromProps(e){return{item:L(e.parent,e.index)}}constructor(e){super(e),this.state={}}shouldComponentUpdate(e,t){const i=this.state.item,r=t.item;return i!==r&&["selected","value","name","searchTerm"].some(a=>i[a]!==r[a])}render(){const e=this.state.item,t=`${e.id||e.value}`;return s.jsx("div",{className:u("form-group",S.row,"tc-multi-select-item"),style:this.props.style,children:s.jsx("div",{className:"checkbox",children:s.jsxs("label",{children:[s.jsx("input",{id:`checkbox-${t}`,type:"checkbox",checked:!!e.selected,onChange:i=>this.props.parent.props.onRowClick({event:i,rowData:e.value})}),s.jsx("span",{className:`${S.item} control-label`,htmlFor:`checkbox-${t}`,children:s.jsx(A,{text:e.name,value:e.searchTerm})})]})})})}}j.propTypes={style:o.object,index:o.number,parent:o.shape({props:o.shape({collection:o.array,onRowClick:o.func})})};function E(n){return s.jsx(j,{...n})}E.rowHeight=40;class k extends d.Component{static getDerivedStateFromProps(e){return{item:L(e.parent,e.index)}}constructor(e){super(e),this.state={}}shouldComponentUpdate(e,t){const i=this.state.item,r=t.item;return i!==r&&["selected","value","name"].some(a=>i[a]!==r[a])}render(){const e=this.state.item;return s.jsx("div",{style:this.props.style,children:s.jsx(F,{label:e.name,selected:!0,onDelete:t=>this.props.parent.props.onRowClick({event:t,rowData:e.value})})})}}k.propTypes={style:o.object,index:o.number,parent:o.shape({props:o.shape({collection:o.array,onRowClick:o.func})})};function R(n){return s.jsx(k,{...n})}R.rowHeight=35;const W="_container_1dyxh_2",$="_clearall_1dyxh_13",K="_caret_1dyxh_21",p={container:W,clearall:$,caret:K};function z(n){return n.reduce((e,t)=>(e.set(t,!0),e),new Map)}function v(n,e){return n.parentElement===null?!1:n.parentElement!==e?v(n.parentElement,e):!0}class q extends d.Component{static displayName="MultiSelect";static theme=p;static defaultProps={itemOptionRender:E,itemViewRender:R,selected:[],options:[]};static propTypes={id:o.string.isRequired,name:o.string,placeholder:o.string,t:o.func,selected:o.arrayOf(o.string),itemOptionRender:o.func,itemViewRender:o.func,restricted:o.bool,readOnly:o.bool,disabled:o.bool,autoFocus:o.bool,isLoading:o.bool,onChange:o.func,onBlur:o.func,onFocus:o.func,options:o.array};constructor(e){super(e),this.state={added:[]},this.onSearchChange=this.onSearchChange.bind(this),this.onRowClick=this.onRowClick.bind(this),this.onInputFocus=this.onInputFocus.bind(this),this.onInputKeyDown=this.onInputKeyDown.bind(this),this.onClearAll=this.onClearAll.bind(this),this.closeOnOutsideClick=this.closeOnOutsideClick.bind(this),this.initSelectedMap=D(z)}componentDidMount(){document.addEventListener("click",this.closeOnOutsideClick)}componentWillUnmount(){document.removeEventListener("click",this.closeOnOutsideClick)}closeOnOutsideClick(e){this.containerRef!==null&&!v(e.target,this.containerRef)&&this.setState({showDropdown:!1,searchTerm:""})}onInputFocus(e){this.setState({showDropdown:!0}),this.props.onFocus&&this.props.onFocus(e)}onInputKeyDown(e){(e.key==="Esc"||e.key==="Escape")&&(e.preventDefault(),this.setState({showDropdown:!1}))}onClearAll(e){this.updateSelection(e,new Map)}onSearchChange(e){this.setState({searchTerm:e.target.value})}onRowClick(e,t){switch(t){case x:this.selectAll(e);break;case C:this.createNew(e);break;default:this.selectOne(e,t)}}getSelectedMap(){return this.state.selected?this.state.selected:this.initSelectedMap(this.props.selected)}getSelectedItems(){const e=this.getSelectedMap();return this.props.options.concat(this.state.added||[]).filter(t=>e.get(t.value))}getFilteredOptions(){const{added:e=[],searchTerm:t=""}=this.state,{options:i,restricted:r,t:a}=this.props,l=i.concat(e);if(!t)return l;let c=!1;const w=t.toLowerCase(),g=l.filter(({name:f})=>{const O=f.toLowerCase();return c=c||O===w,f.toLowerCase().indexOf(w)!==-1});return!r&&!c&&g.push({value:C,name:a("MULTI_SELECT_LABEL_CREATE_NEW",{defaultValue:"{{name}} (Create entry)",name:t})}),g}getListItems(){const{searchTerm:e}=this.state,{t}=this.props,i=this.getFilteredOptions().map(r=>({name:r.name,value:r.value,selected:this.getSelectedMap().get(r.value),searchTerm:e}));if(i.length){const r=i.every(a=>a.selected);i.unshift({value:x,name:r?t("MULTI_SELECT_LABEL_DESELECT_ALL",{defaultValue:"Deselect all"}):t("MULTI_SELECT_LABEL_SELECT_ALL",{defaultValue:"Select all"}),selected:r})}return i}createNew(e){const t={name:this.state.searchTerm,value:this.state.searchTerm},i=new Map(this.getSelectedMap());i.set(t.value,!0),this.updateSelection(e,i),this.setState(({added:r})=>({added:r.concat([t])}))}selectAll(e){const t=this.getSelectedMap(),i=this.getFilteredOptions(),r=i.every(({value:l})=>t.get(l)),a=new Map(t);i.reduce((l,c)=>(r?l.delete(c.value):l.set(c.value,!0),l),a),this.updateSelection(e,a)}selectOne(e,t){const i=new Map(this.getSelectedMap());i.get(t)?i.delete(t):i.set(t,!0),this.updateSelection(e,i)}updateSelection(e,t){this.props.onChange?this.props.onChange(e,Array.from(t.keys())):this.setState({selected:t})}render(){const e=this.getListItems(),t=Math.min(e.length,6)||1,i=this.props.isLoading?120:this.props.itemOptionRender.rowHeight*t,r=this.getSelectedMap().size,a=this.props.itemViewRender.rowHeight*Math.min(6,r+1);return s.jsxs("div",{id:this.props.id,className:u("tc-multiselect",p.container),ref:l=>{this.containerRef=l},children:[s.jsx(T,{name:"talend-caret-down",className:p.caret,transform:this.state.showDropdown?"flip-vertical":null}),!!r&&s.jsx(N,{icon:"talend-cross",bsStyle:"link",className:u("btn-icon-only","btn-sm",p.clearall),label:this.props.t("MULTI_SELECT_LABEL_CLEAR_ALL",{defaultValue:"Clear all"}),onClick:this.onClearAll,hideLabel:!0}),s.jsx("input",{type:"text",role:"search",className:"form-control",name:this.props.name,onBlur:this.props.onBlur,onChange:this.onSearchChange,onFocus:this.onInputFocus,onKeyDown:this.onInputKeyDown,disabled:this.props.disabled,autoFocus:this.props.autoFocus,placeholder:this.props.placeholder,readOnly:this.props.readOnly,value:this.state.searchTerm,ref:l=>{this.inputRef=l}}),this.state.showDropdown&&s.jsx(_,{height:i,isLoading:this.props.isLoading,items:e,onRowClick:this.onRowClick,renderItem:this.props.itemOptionRender}),!this.state.showDropdown&&r>0&&s.jsx("div",{style:{height:a},children:s.jsx(b,{type:"tc-multiselect",rowHeight:this.props.itemViewRender.rowHeight,rowRenderers:{"tc-multiselect":this.props.itemViewRender},collection:this.getSelectedItems(),onRowClick:this.onRowClick})})]})}}const m=V(I)(q);class G extends d.Component{constructor(e){super(e),this.state={loading:!0,photos:[]}}componentDidMount(){fetch("https://jsonplaceholder.typicode.com/photos").then(e=>e.json()).then(e=>{this.setState({loading:!1,photos:e.map(t=>({id:t.id,value:t.id,name:t.title}))})})}render(){return s.jsx("section",{style:{margin:20},children:s.jsxs("form",{className:"form",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"control-label",htmlFor:"storybook",children:"photos"}),s.jsx(m,{id:"storybook",options:this.state.photos,isLoading:this.state.loading,withCreateNew:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"control-label",htmlFor:"storybook",children:"Empty"}),s.jsx(m,{id:"storybook",options:[],isLoading:this.state.loading,withCreateNew:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"control-label",htmlFor:"storybook",children:"2 items"}),s.jsx(m,{id:"storybook",options:this.state.photos?.splice(0,2),isLoading:this.state.loading,withCreateNew:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"control-label",htmlFor:"useless",children:"another"}),s.jsx("input",{className:"form-control",type:"text",id:"useless"})]})]})})}}const it={title:"Components/Deprecated/MultiSelect"},h=()=>s.jsx(G,{});h.parameters={...h.parameters,docs:{...h.parameters?.docs,source:{originalSource:"() => <Photos />",...h.parameters?.docs?.source}}};const rt=["Default"];export{h as Default,rt as __namedExportsOrder,it as default};
