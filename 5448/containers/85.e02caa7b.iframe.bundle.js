"use strict";(self.webpackChunk_talend_react_containers=self.webpackChunk_talend_react_containers||[]).push([[85],{"./src/List/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>src_List});var List_constant_namespaceObject={};__webpack_require__.r(List_constant_namespaceObject),__webpack_require__.d(List_constant_namespaceObject,{default:()=>List_constant});var selector_namespaceObject={};__webpack_require__.r(selector_namespaceObject),__webpack_require__.d(selector_namespaceObject,{compare:()=>compare,configureGetFilteredItems:()=>configureGetFilteredItems,configureGetPagedItems:()=>configureGetPagedItems,configureGetPagination:()=>configureGetPagination,configureGetSortedItems:()=>configureGetSortedItems,getCollectionItems:()=>getCollectionItems,getSortedResults:()=>getSortedResults});var immutable=__webpack_require__("../../node_modules/immutable/dist/immutable.js"),lib_esm=__webpack_require__("../cmf/lib-esm/index.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),ImmutablePropTypes=__webpack_require__("../../node_modules/react-immutable-proptypes/dist/ImmutablePropTypes.js"),ImmutablePropTypes_default=__webpack_require__.n(ImmutablePropTypes),actionAPI=__webpack_require__("./src/actionAPI.js");const List_constant={LIST_TOGGLE_FILTER:"LIST_TOGGLE_FILTER",LIST_FILTER_CHANGE:"LIST_FILTER_CHANGE",LIST_CHANGE_SORT_ORDER:"LIST_CHANGE_SORT_ORDER"};var lodash=__webpack_require__("../../node_modules/lodash/lodash.js"),components_lib_esm=__webpack_require__("../components/lib-esm/index.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const ConnectedCellTitle=(0,lib_esm.TJ)({mapStateToProps:function mapStateToProps(state,ownProps){if(!ownProps.columnData)return{};const exp=lib_esm.Ay.expression.mapStateToProps(state,ownProps.columnData,{props:ownProps});return Object.keys(exp).length?{columnData:{...lib_esm.Ay.expression.mergeProps(ownProps.columnData),...exp}}:{}},omitCMFProps:!0,withComponentRegistry:!0,withDispatch:!0,withDispatchActionCreator:!0,withComponentId:!0})(components_lib_esm.VirtualizedList.cellDictionary.title.cellRenderer),connectedCellDictionary={title:{...components_lib_esm.VirtualizedList.cellDictionary.title,cellRenderer:props=>(0,jsx_runtime.jsx)(ConnectedCellTitle,{...props})}},DEFAULT_STATE=new immutable.Map({displayMode:"table",selectedItems:new immutable.List,searchQuery:"",itemsPerPage:10,startIndex:1,totalResults:0,sortOn:"name",sortAsc:!0,filterDocked:!0});function List(props){const context=(0,lib_esm.n7)(),state=props.state.toJS();function getSelectedItems(){return props.state.get("selectedItems",new immutable.List)}function getGenericDispatcher(property){return(event,data)=>{props.dispatchActionCreator(property,event,data,context)}}const items=function getItems(context,props){return props.items.toJS().map((item=>{const actionsItems=(0,lodash.get)(props,"actions.items",[]);let actions=[];return actions=Array.isArray(actionsItems)&&actionsItems.every((actionsItem=>Array.isArray(actionsItem)))?actionsItems.map((actionArray=>(0,actionAPI.c)(context,actionArray,item))):(0,actionAPI.c)(context,actionsItems,item),{...item,actions,persistentActions:(0,actionAPI.c)(context,(0,lodash.get)(props,"actions.persistentItemsActions",[]),item)}}))}(context,props),newProps={...(0,lodash.omit)(props,lib_esm.TJ.INJECTED_PROPS)};newProps.displayMode||(newProps.displayMode=state.displayMode),newProps.list||(newProps.list={}),newProps.list.id||(newProps.list.id="list"),newProps.list.items=items,newProps.list.columns||(newProps.list.columns=[]),newProps.list.sort={field:state.sortOn,isDescending:!state.sortAsc,onChange:(event,data)=>{props.dispatch({type:List_constant.LIST_CHANGE_SORT_ORDER,payload:data,collectionId:props.collectionId,event})}},newProps.list.itemProps||(newProps.list.itemProps={}),newProps.rowHeight&&(newProps.rowHeight=newProps.rowHeight[newProps.displayMode]),newProps.list.titleProps&&newProps.actions.title&&(newProps.actions.title&&(newProps.list.titleProps.onClick=getGenericDispatcher(newProps.actions.title)),newProps.actions.editSubmit&&(newProps.list.titleProps.onEditSubmit=getGenericDispatcher(newProps.actions.editSubmit)),newProps.actions.editCancel&&(newProps.list.titleProps.onEditCancel=getGenericDispatcher(newProps.actions.editCancel)));const cellDictionary={...connectedCellDictionary};if(newProps.cellDictionary&&Object.keys(newProps.cellDictionary).reduce(((accumulator,key)=>{const current=newProps.cellDictionary[key];return accumulator[key]={...(0,lodash.omit)(current,["component"]),cellRenderer:props.getComponent(current.component)},accumulator}),cellDictionary),newProps.list.cellDictionary=cellDictionary,newProps.headerDictionary&&(newProps.list.headerDictionary=Object.keys(newProps.headerDictionary).reduce(((accumulator,key)=>{const current=newProps.headerDictionary[key];return accumulator[key]={...(0,lodash.omit)(current,["component"]),headerRenderer:props.getComponent(current.component)},accumulator}),{})),newProps.toolbar){newProps.toolbar.display&&(newProps.toolbar.display={...newProps.toolbar.display,onChange:(event,data)=>{!function onSelectDisplayMode(event,payload){props.setState({displayMode:payload})}(0,data)}}),newProps.toolbar.sort&&(newProps.toolbar.sort.isDescending=!state.sortAsc,newProps.toolbar.sort.field=state.sortOn,newProps.toolbar.sort.onChange=(event,data)=>{props.dispatch({type:List_constant.LIST_CHANGE_SORT_ORDER,payload:data,collectionId:props.collectionId,event})}),newProps.toolbar.filter&&(newProps.toolbar.filter.onToggle=(event,data)=>{props.dispatch({type:List_constant.LIST_TOGGLE_FILTER,payload:{...data,filterDocked:state.filterDocked,searchQuery:state.searchQuery},collectionId:props.collectionId,event})},newProps.toolbar.filter.onFilter=(event,data)=>{props.dispatch({type:List_constant.LIST_FILTER_CHANGE,payload:data,collectionId:props.collectionId,event})},newProps.toolbar.filter.docked=state.filterDocked,newProps.toolbar.filter.value=state.searchQuery),newProps.toolbar.actionBar={actions:{},multiSelectActions:{}},newProps.multiSelectActions&&props.idKey&&(newProps.list.itemProps.onToggle=function onToggleMultiSelection(event,data){const selectedItems=getSelectedItems(),dataIndex=selectedItems.indexOf(data[props.idKey]);dataIndex>-1?props.setState({selectedItems:selectedItems.splice(dataIndex,1)}):props.setState({selectedItems:selectedItems.push(data[props.idKey])})},newProps.list.itemProps.onToggleAll=function onToggleAllMultiSelection(){const selectedItems=getSelectedItems(),items=props.items;selectedItems.size!==items.size?props.setState({selectedItems:items.map((item=>item.get(props.idKey)))}):props.setState({selectedItems:new immutable.List([])})},newProps.list.itemProps.isSelected=function isSelected(item){return getSelectedItems().some((itemKey=>itemKey===item[props.idKey]))},newProps.toolbar.actionBar.selected=getSelectedItems().size);const actions=newProps.actions,multiSelectActions=newProps.multiSelectActions;if(multiSelectActions&&(multiSelectActions.left&&(newProps.toolbar.actionBar.multiSelectActions.left=multiSelectActions.left.map((action=>({actionId:action})))),multiSelectActions.right&&(newProps.toolbar.actionBar.multiSelectActions.right=multiSelectActions.right.map((action=>({actionId:action}))))),actions&&(actions.left&&(newProps.toolbar.actionBar.actions.left=actions.left.map((action=>({actionId:action})))),actions.right&&(newProps.toolbar.actionBar.actions.right=actions.right.map((action=>({actionId:action}))))),newProps.toolbar.pagination){const pagination=newProps.toolbar.pagination;if(_extends(newProps.toolbar.pagination,{...(0,lodash.pick)(state,["totalResults","itemsPerPage","startIndex"])}),pagination.onChange){if("string"==typeof pagination.onChange){const onChangeActionCreator=pagination.onChange;pagination.onChange=(startIndex,itemsPerPage)=>{props.dispatchActionCreator(onChangeActionCreator,null,{startIndex,itemsPerPage},context)}}}else pagination.onChange=(startIndex,itemsPerPage)=>{!function onChangePage(startIndex,itemsPerPage){props.setState({startIndex,itemsPerPage})}(startIndex,itemsPerPage)}}}return(0,jsx_runtime.jsx)(components_lib_esm.List,{...newProps})}List.displayName="List",List.displayName="Container(List)",List.propTypes={actions:prop_types_default().shape({title:prop_types_default().string,left:prop_types_default().arrayOf(prop_types_default().string),right:prop_types_default().arrayOf(prop_types_default().string)}),multiSelectActions:prop_types_default().shape({title:prop_types_default().string,left:prop_types_default().arrayOf(prop_types_default().string),right:prop_types_default().arrayOf(prop_types_default().string)}),idKey:prop_types_default().string,list:prop_types_default().shape({columns:prop_types_default().array,titleProps:prop_types_default().object}),toolbar:prop_types_default().shape({sort:prop_types_default().object,filter:prop_types_default().object,pagination:prop_types_default().shape({onChange:prop_types_default().func})}),cellDictionary:prop_types_default().object,displayMode:prop_types_default().string,items:ImmutablePropTypes_default().list.isRequired,state:lib_esm.TJ.propTypes.state,...lib_esm.TJ.propTypes},List.defaultProps={state:DEFAULT_STATE};const List_container=List;var lib=__webpack_require__("../../node_modules/reselect/lib/index.js");function getCollection(state,collectionId){return state.cmf.collections.get(collectionId)}function getCollectionItems(state,collectionId){const collection=getCollection(state,collectionId);return immutable.Map.isMap(collection)?collection.get("items"):collection}function configureGetPagination(state,{collectionId}){const collection=getCollection(state,collectionId);return immutable.Map.isMap(collection)?collection.get("pagination"):null}function getComponentState(collectionId){return state=>state.cmf.components.getIn(["Container(List)",collectionId||"default"])}function configureGetFilteredItems(configure){const localConfig=configure,getFilteredList=(0,lib.Mz)(getComponentState(localConfig.collectionId),(componentState=>{let results=localConfig.items;if(componentState){const searchQuery=componentState.get("searchQuery");searchQuery&&results&&(results=results.filter((item=>function contains(listItem,query,columns){let item=listItem;return immutable.Map.isMap(listItem)&&(item=listItem.toJS()),columns.some((column=>"string"==typeof item[column.key]&&-1!==item[column.key].toLowerCase().indexOf(query.toLowerCase())))}(item,searchQuery,localConfig.columns))))}return results}));return(0,lib.Mz)([getFilteredList,getComponentState],(items=>items))}function compare(sortBy){return(a,b)=>{let aValue=a.get(sortBy),bValue=b.get(sortBy);return"string"==typeof aValue&&"string"==typeof bValue?(aValue=aValue.toLowerCase(),bValue=bValue.toLowerCase(),aValue.localeCompare(bValue)):"number"==typeof aValue&&"number"==typeof bValue?aValue<bValue?-1:aValue>bValue?1:0:b[sortBy]?-1:0}}function getSortedResults(componentState,config,listItems){if(!immutable.List.isList(listItems))return new immutable.List;let results=listItems;if(!(0,lodash.isEmpty)(componentState)){const sortBy=componentState.get("sortOn"),sortAsc=componentState.get("sortAsc"),sortedColumn=(0,lodash.get)(config,"columns",[]).find((column=>column.key===sortBy));results=(0,lodash.get)(sortedColumn,"sortFunction")?results.sort(lib_esm.Ay.registry.getFromRegistry(sortedColumn.sortFunction)(sortBy,sortAsc)):results.sort(compare(sortBy)),sortAsc||(results=results.reverse())}return results}function configureGetSortedItems(config,listItems){const getSortedList=(0,lib.Mz)(getComponentState(config.collectionId),(componentState=>getSortedResults(componentState,config,listItems)));return(0,lib.Mz)([getSortedList,getComponentState],(items=>items))}function configureGetPagedItems(configure,listItems){const getPagedList=(0,lib.Mz)(getComponentState(configure.collectionId),(componentState=>{let results=listItems;if(componentState){const startIndex=componentState.get("startIndex"),itemsPerPage=componentState.get("itemsPerPage");itemsPerPage>0&&startIndex>0&&(results=results.slice(startIndex-1,Math.min(startIndex+itemsPerPage-1,results.size)))}return results}));return(0,lib.Mz)([getPagedList,getComponentState],(items=>items))}const List_connect=(0,lib_esm.TJ)({defaultState:DEFAULT_STATE,defaultProps:{saga:"List#root",listItems:new immutable.List},componentId:function componentId(ownProps){return ownProps.collectionId},mapStateToProps:function List_connect_mapStateToProps(state,ownProps,cmfProps){const props={},collectionItems=getCollectionItems(state,ownProps.collectionId),config={collectionId:ownProps.collectionId,items:collectionItems||ownProps.items||ownProps.listItems,defaultFiltering:(0,lodash.get)(ownProps,["toolbar","filter","defaultFiltering"]),defaultSorting:(0,lodash.get)(ownProps,["toolbar","sort","defaultSorting"]),defaultPaging:(0,lodash.get)(ownProps,["toolbar","pagination","defaultPaging"])};ownProps.list&&(config.columns=ownProps.list.columns),props.items=function List_connect_getItems(state,config){let items=config.items;return!1!==config.defaultFiltering&&(items=configureGetFilteredItems(config)(state)),!1!==config.defaultSorting&&(items=configureGetSortedItems(config,items)(state)),items}(state,config);const totalResults=props.items.size;(0,lodash.get)(ownProps,["toolbar","pagination"])&&(props.items=function getPagedItems(state,config,items){return!1!==config.defaultPaging?configureGetPagedItems(config,items)(state):items}(state,config,props.items));const cmfState=(0,lodash.get)(cmfProps,"state");return cmfState&&(props.state=cmfState.setIn(["totalResults"],totalResults),props.state.has("toolbar")&&(props.state=props.state.mergeIn(["toolbar","pagination"],configureGetPagination(state,config)))),props},omitCMFProps:!0,withComponentRegistry:!0,withDispatch:!0,withDispatchActionCreator:!0,withComponentId:!0})(List_container);var redux_saga_effects_npm_proxy_esm=__webpack_require__("../../node_modules/redux-saga/dist/redux-saga-effects-npm-proxy.esm.js");function*onFilterChange(data){yield(0,redux_saga_effects_npm_proxy_esm.yJ)(List_connect.setStateAction({searchQuery:data.payload.query},data.collectionId||"default"))}function*onToggleFilter(data){yield(0,redux_saga_effects_npm_proxy_esm.yJ)(List_connect.setStateAction({filterDocked:!data.payload.filterDocked},data.collectionId||"default"))}function*onChangeSortChange(data){yield(0,redux_saga_effects_npm_proxy_esm.yJ)(List_connect.setStateAction({sortOn:data.payload.field,sortAsc:!data.payload.isDescending},data.collectionId||"default"))}const List_sagas={"List#root":function*defaultHandler(){yield(0,redux_saga_effects_npm_proxy_esm.jP)(List_constant.LIST_TOGGLE_FILTER,onToggleFilter),yield(0,redux_saga_effects_npm_proxy_esm.jP)(List_constant.LIST_FILTER_CHANGE,onFilterChange),yield(0,redux_saga_effects_npm_proxy_esm.jP)(List_constant.LIST_CHANGE_SORT_ORDER,onChangeSortChange)}};List_connect.sagas=List_sagas,List_connect.constants=List_constant_namespaceObject,List_connect.selectors=selector_namespaceObject;const src_List=List_connect},"./src/actionAPI.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>getActionsProps});var _talend_react_cmf__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../cmf/lib-esm/index.js"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/lodash/lodash.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}function evalExpressions(action,context,payload={}){return _talend_react_cmf__WEBPACK_IMPORTED_MODULE_0__.Ay.expression.getProps(action,["active","available","disabled","inProgress"],context,payload)}function getActionsProps(context,ids,model){if(!ids)return[];let tmpIds=ids;const onlyOne="string"==typeof ids||"object"==typeof ids&&!Array.isArray(ids);onlyOne&&(tmpIds=[ids]);const props=tmpIds.map((id=>"string"==typeof id?_talend_react_cmf__WEBPACK_IMPORTED_MODULE_0__.Ay.action.getActionInfo(context,id):id)).map((info=>{const newprops={},dispatch=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.get)(context,"store.dispatch");return dispatch&&(newprops.onClick=(event,data)=>{info.actionCreator?dispatch(_talend_react_cmf__WEBPACK_IMPORTED_MODULE_0__.Ay.action.getActionObject(context,info.id,event,data)):dispatch({model,...info.payload})}),_extends(newprops,evalExpressions(info,context,{model})),newprops}));return onlyOne?props[0]:props}}}]);