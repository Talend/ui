import{e as h,I as u,r as A,P as r,u as S,j as C,am as m}from"./iframe-DSAcyFY1.js";import{o as I}from"./omit-Bpo1vHQh.js";const c="opened",i="selectedId",w="Container(TreeView)",E={idAttr:"id",nameAttr:"name",childrenAttr:"children"},g=new u.Map({[c]:new u.List,[i]:void 0});function f(s,t,e){return!s.children||!s.children.length?!1:s.children.some(n=>n[t]===e||f(n,t,e))}function b(s,t,e){const n=t[e],p=s.state.get(c),a=p.indexOf(n);if(a!==-1){let o=s.state.set(c,p.delete(a));const l=o.get(i);return l!==void 0&&f(t,e,l)&&(o=o.set(i,void 0)),o}return s.state.set(c,s.state.get(c).push(n))}function x(s,t,e){const n=t.reduce((p,a)=>p.add(a[e]),s.state.get(c).toSet()).toList();return s.state.set(c,n)}function D(s,t){const e=s.state.get(i);return t===e?s.state.set(i,void 0):s.state.set(i,t)}function T(s,t,e){if(!s)return;const n=t.state||g,p=n.get(i),a=n.get(c);return s.map(o=>{const l={...o,id:o[t.idAttr],isOpened:o.isOpened||a.includes(o[t.idAttr]),name:o[t.nameAttr],parent:e};if(l.children=T(o[t.childrenAttr],t,l),o[t.idAttr]===p)for(let d=l;d.parent;d=d.parent)d.parent.isOpened=!0;return l})}class y extends A.Component{static displayName=w;static propTypes={childrenAttr:r.string,data:S.list,idAttr:r.string,nameAttr:r.string,onClick:r.func,onToggle:r.func,onSelect:r.func,onClickActionCreator:r.string,onSelectActionCreator:r.string,...h.propTypes};static defaultProps=E;constructor(t){super(t),this.onSelect=this.onSelect.bind(this),this.onToggle=this.onToggle.bind(this),this.onToggleAllSiblings=this.onToggleAllSiblings.bind(this),t.onClick}onSelect(t,e){this.props.setState(n=>D(n,e[this.props.idAttr])),this.props.onSelectActionCreator&&this.props.dispatchActionCreator(this.props.onSelectActionCreator,{type:"select",source:"TreeView",props:this.props},e),this.props.onSelect&&this.props.onSelect(e)}onToggle(t,e){this.props.setState(n=>b(n,e,this.props.idAttr)),this.props.onClickActionCreator&&this.props.dispatchActionCreator(this.props.onClickActionCreator,{type:"toggle",source:"TreeView",props:this.props},e),this.props.onToggle&&this.props.onToggle(e),this.props.onClick&&this.props.onClick(e)}onToggleAllSiblings(t,e){this.props.setState(n=>x(n,e,this.props.idAttr))}getSelectedId(){const t=this.props[i];return t!==void 0?t:(this.props.state||g).get(i)}render(){if(!this.props.data)return null;const t=T(this.props.data.toJS(),this.props),e=I(this.props,h.INJECTED_PROPS);return C.jsx(m,{...e,structure:t,onSelect:this.onSelect,onToggle:this.onToggle,onToggleAllSiblings:this.onToggleAllSiblings,selectedId:this.getSelectedId()})}}function O(s,t){const e={};return t.collection&&(e.data=s.cmf.collections.getIn(t.collection.split(".")),e.data||console.warn("TreeView.collection not found")),e}const L=h({defaultState:g,mapStateToProps:O,omitCMFProps:!0,withComponentRegistry:!0,withDispatch:!0,withDispatchActionCreator:!0,withComponentId:!0})(y);export{w as D,L as T};
